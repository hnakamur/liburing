<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>liburing: test/file-register.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">liburing
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">test/file-register.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/* SPDX-License-Identifier: MIT */</span></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Description: run various file registration tests</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;fcntl.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="liburing_8h.html">liburing.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> no_update = 0;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> close_files(<span class="keywordtype">int</span> *files, <span class="keywordtype">int</span> nr_files, <span class="keywordtype">int</span> add)</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> fname[32];</div><div class="line">    <span class="keywordtype">int</span> i;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nr_files; i++) {</div><div class="line">        <span class="keywordflow">if</span> (files)</div><div class="line">            close(files[i]);</div><div class="line">        <span class="keywordflow">if</span> (!add)</div><div class="line">            sprintf(fname, <span class="stringliteral">&quot;.reg.%d&quot;</span>, i);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">            sprintf(fname, <span class="stringliteral">&quot;.add.%d&quot;</span>, i + add);</div><div class="line">        unlink(fname);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (files)</div><div class="line">        free(files);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> *open_files(<span class="keywordtype">int</span> nr_files, <span class="keywordtype">int</span> extra, <span class="keywordtype">int</span> add)</div><div class="line">{</div><div class="line">    <span class="keywordtype">char</span> fname[32];</div><div class="line">    <span class="keywordtype">int</span> *files;</div><div class="line">    <span class="keywordtype">int</span> i;</div><div class="line"></div><div class="line">    files = calloc(nr_files + extra, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; nr_files; i++) {</div><div class="line">        <span class="keywordflow">if</span> (!add)</div><div class="line">            sprintf(fname, <span class="stringliteral">&quot;.reg.%d&quot;</span>, i);</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">            sprintf(fname, <span class="stringliteral">&quot;.add.%d&quot;</span>, i + add);</div><div class="line">        files[i] = open(fname, O_RDWR | O_CREAT, 0644);</div><div class="line">        <span class="keywordflow">if</span> (files[i] &lt; 0) {</div><div class="line">            perror(<span class="stringliteral">&quot;open&quot;</span>);</div><div class="line">            free(files);</div><div class="line">            files = NULL;</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">if</span> (extra) {</div><div class="line">        <span class="keywordflow">for</span> (i = nr_files; i &lt; nr_files + extra; i++)</div><div class="line">            files[i] = -1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> files;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_shrink(<span class="keyword">struct</span> <a name="_a0"></a><a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> ret, off, fd;</div><div class="line">    <span class="keywordtype">int</span> *files;</div><div class="line"></div><div class="line">    files = open_files(50, 0, 0);</div><div class="line">    ret = <a name="a1"></a><a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 50);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    off = 0;</div><div class="line">    <span class="keywordflow">do</span> {</div><div class="line">        fd = -1;</div><div class="line">        ret = <a name="a2"></a><a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(ring, off, &amp;fd, 1);</div><div class="line">        <span class="keywordflow">if</span> (ret != 1) {</div><div class="line">            <span class="keywordflow">if</span> (off == 50 &amp;&amp; ret == -EINVAL)</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;%s: update ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        off++;</div><div class="line">    } <span class="keywordflow">while</span> (1);</div><div class="line"></div><div class="line">    ret = <a name="a3"></a><a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    close_files(files, 50, 0);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 50, 0);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_grow(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> ret, off;</div><div class="line">    <span class="keywordtype">int</span> *files, *fds = NULL;</div><div class="line"></div><div class="line">    files = open_files(50, 250, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 300);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    off = 50;</div><div class="line">    <span class="keywordflow">do</span> {</div><div class="line">        fds = open_files(1, 0, off);</div><div class="line">        ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(ring, off, fds, 1);</div><div class="line">        <span class="keywordflow">if</span> (ret != 1) {</div><div class="line">            <span class="keywordflow">if</span> (off == 300 &amp;&amp; ret == -EINVAL)</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;%s: update ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (off &gt;= 300) {</div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;%s: Succeeded beyond end-of-list?\n&quot;</span>, __FUNCTION__);</div><div class="line">            <span class="keywordflow">goto</span> err;</div><div class="line">        }</div><div class="line">        off++;</div><div class="line">    } <span class="keywordflow">while</span> (1);</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    close_files(files, 100, 0);</div><div class="line">    close_files(NULL, 251, 50);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    close_files(NULL, 251, 50);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_replace_all(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files, *fds = NULL;</div><div class="line">    <span class="keywordtype">int</span> ret, i;</div><div class="line"></div><div class="line">    files = open_files(100, 0, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 100);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    fds = malloc(100 * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 100; i++)</div><div class="line">        fds[i] = -1;</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(ring, 0, fds, 100);</div><div class="line">    <span class="keywordflow">if</span> (ret != 100) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: update ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        free(fds);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        free(fds);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_replace(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files, *fds = NULL;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    files = open_files(100, 0, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 100);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    fds = open_files(10, 0, 1);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(ring, 90, fds, 10);</div><div class="line">    <span class="keywordflow">if</span> (ret != 10) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: update ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        close_files(fds, 10, 1);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        close_files(fds, 10, 1);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_removals(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files, *fds = NULL;</div><div class="line">    <span class="keywordtype">int</span> ret, i;</div><div class="line"></div><div class="line">    files = open_files(100, 0, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 100);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    fds = calloc(10, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 10; i++)</div><div class="line">        fds[i] = -1;</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(ring, 50, fds, 10);</div><div class="line">    <span class="keywordflow">if</span> (ret != 10) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: update ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        free(fds);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        free(fds);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_additions(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files, *fds = NULL;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    files = open_files(100, 100, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 200);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    fds = open_files(2, 0, 1);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(ring, 100, fds, 2);</div><div class="line">    <span class="keywordflow">if</span> (ret != 2) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: update ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        close_files(fds, 2, 1);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        close_files(fds, 2, 1);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_sparse(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    files = open_files(100, 100, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 200);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        <span class="keywordflow">if</span> (ret == -EBADF) {</div><div class="line">            fprintf(stdout, <span class="stringliteral">&quot;Sparse files not supported\n&quot;</span>);</div><div class="line">            no_update = 1;</div><div class="line">            <span class="keywordflow">goto</span> done;</div><div class="line">        }</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line">done:</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_basic_many(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    files = open_files(768, 0, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 768);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register %d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister %d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line">    close_files(files, 768, 0);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 768, 0);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_basic(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    files = open_files(100, 0, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 100);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register %d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister %d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    close_files(files, 100, 0);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Register 0 files, but reserve space for 10.  Then add one file.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_zero(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files, *fds = NULL;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    files = open_files(0, 10, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 10);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    fds = open_files(1, 0, 1);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(ring, 0, fds, 1);</div><div class="line">    <span class="keywordflow">if</span> (ret != 1) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: update ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        close_files(fds, 1, 1);</div><div class="line">    free(files);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    <span class="keywordflow">if</span> (fds)</div><div class="line">        close_files(fds, 1, 1);</div><div class="line">    free(files);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_fixed_read_write(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring, <span class="keywordtype">int</span> index)</div><div class="line">{</div><div class="line">    <span class="keyword">struct </span><a name="_a4"></a><a class="code" href="structio__uring__sqe.html">io_uring_sqe</a> *sqe;</div><div class="line">    <span class="keyword">struct </span><a name="_a5"></a><a class="code" href="structio__uring__cqe.html">io_uring_cqe</a> *cqe;</div><div class="line">    <span class="keyword">struct </span>iovec iov[2];</div><div class="line">    <span class="keywordtype">int</span> ret, i;</div><div class="line"></div><div class="line">    iov[0].iov_base = malloc(4096);</div><div class="line">    iov[0].iov_len = 4096;</div><div class="line">    memset(iov[0].iov_base, 0x5a, 4096);</div><div class="line"></div><div class="line">    iov[1].iov_base = malloc(4096);</div><div class="line">    iov[1].iov_len = 4096;</div><div class="line"></div><div class="line">    sqe = <a name="a6"></a><a class="code" href="liburing_8h.html#aa2ce0e4b691ae0faf188a38974dd203c">io_uring_get_sqe</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (!sqe) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: failed to get sqe\n&quot;</span>, __FUNCTION__);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    <a name="a7"></a><a class="code" href="liburing_8h.html#a27a47f862d46dd201537e2c1d7c84e5c">io_uring_prep_writev</a>(sqe, index, &amp;iov[0], 1, 0);</div><div class="line">    sqe-&gt;<a name="a8"></a><a class="code" href="structio__uring__sqe.html#a0a11108c417cb20e4c954c54512da174">flags</a> |= <a name="a9"></a><a class="code" href="io__uring_8h.html#a7d28d06f2893f2d5918698d875e87b82">IOSQE_FIXED_FILE</a>;</div><div class="line">    sqe-&gt;<a name="a10"></a><a class="code" href="structio__uring__sqe.html#abc3388068aa56d0d4f21127308c17093">user_data</a> = 1;</div><div class="line"></div><div class="line">    sqe = <a class="code" href="liburing_8h.html#aa2ce0e4b691ae0faf188a38974dd203c">io_uring_get_sqe</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (!sqe) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: failed to get sqe\n&quot;</span>, __FUNCTION__);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line">    <a name="a11"></a><a class="code" href="liburing_8h.html#a56cdb58687ef463f95b5b0b042fdd3b7">io_uring_prep_readv</a>(sqe, index, &amp;iov[1], 1, 0);</div><div class="line">    sqe-&gt;<a class="code" href="structio__uring__sqe.html#a0a11108c417cb20e4c954c54512da174">flags</a> |= <a class="code" href="io__uring_8h.html#a7d28d06f2893f2d5918698d875e87b82">IOSQE_FIXED_FILE</a>;</div><div class="line">    sqe-&gt;<a class="code" href="structio__uring__sqe.html#abc3388068aa56d0d4f21127308c17093">user_data</a> = 2;</div><div class="line"></div><div class="line">    ret = <a name="a12"></a><a class="code" href="liburing_8h.html#a556bbd9cfb46506458b32573a5326ad8">io_uring_submit</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret != 2) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: got %d, wanted 2\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {</div><div class="line">        ret = <a name="a13"></a><a class="code" href="liburing_8h.html#aa0f0333a8222c06ec2518bce538f2a4b">io_uring_wait_cqe</a>(ring, &amp;cqe);</div><div class="line">        <span class="keywordflow">if</span> (ret &lt; 0) {</div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;%s: io_uring_wait_cqe=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">            <span class="keywordflow">return</span> 1;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (cqe-&gt;<a name="a14"></a><a class="code" href="structio__uring__cqe.html#adaac31b8e29aed568936439ccf95568f">res</a> != 4096) {</div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;%s: cqe-&gt;res=%d\n&quot;</span>, __FUNCTION__, cqe-&gt;<a class="code" href="structio__uring__cqe.html#adaac31b8e29aed568936439ccf95568f">res</a>);</div><div class="line">            <span class="keywordflow">return</span> 1;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">if</span> (cqe-&gt;<a name="a15"></a><a class="code" href="structio__uring__cqe.html#a4c73e32afb2d23bb1d2d275e693bf1d5">user_data</a> == 2) {</div><div class="line">            <span class="keywordflow">if</span> (memcmp(iov[1].iov_base, iov[0].iov_base, 4096)) {</div><div class="line">                fprintf(stderr, <span class="stringliteral">&quot;%s: data mismatch\n&quot;</span>, __FUNCTION__);</div><div class="line">                <span class="keywordflow">return</span> 1;</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <a name="a16"></a><a class="code" href="liburing_8h.html#a7dbfdb712ef47a06acdd9e74644a1c38">io_uring_cqe_seen</a>(ring, cqe);</div><div class="line">    }</div><div class="line"></div><div class="line">    free(iov[0].iov_base);</div><div class="line">    free(iov[1].iov_base);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Register 8K of sparse files, update one at a random spot, then do some</span></div><div class="line"><span class="comment"> * file IO to verify it works.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_huge(<span class="keyword">struct</span> <a class="code" href="structio__uring.html">io_uring</a> *ring)</div><div class="line">{</div><div class="line">    <span class="keywordtype">int</span> *files;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    files = open_files(0, 8192, 0);</div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(ring, files, 8192);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        <span class="comment">/* huge sets not supported */</span></div><div class="line">        <span class="keywordflow">if</span> (ret == -EMFILE) {</div><div class="line">            fprintf(stdout, <span class="stringliteral">&quot;%s: No huge file set support, skipping\n&quot;</span>, __FUNCTION__);</div><div class="line">            <span class="keywordflow">goto</span> out;</div><div class="line">        }</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: register ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    files[7193] = open(<span class="stringliteral">&quot;.reg.7193&quot;</span>, O_RDWR | O_CREAT, 0644);</div><div class="line">    <span class="keywordflow">if</span> (files[7193] &lt; 0) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: open=%d\n&quot;</span>, __FUNCTION__, errno);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(ring, 7193, &amp;files[7193], 1);</div><div class="line">    <span class="keywordflow">if</span> (ret != 1) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: update ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (test_fixed_read_write(ring, 7193))</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;%s: unregister ret=%d\n&quot;</span>, __FUNCTION__, ret);</div><div class="line">        <span class="keywordflow">goto</span> err;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (files[7193] != -1) {</div><div class="line">        close(files[7193]);</div><div class="line">        unlink(<span class="stringliteral">&quot;.reg.7193&quot;</span>);</div><div class="line">    }</div><div class="line">out:</div><div class="line">    free(files);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">err:</div><div class="line">    <span class="keywordflow">if</span> (files[7193] != -1) {</div><div class="line">        close(files[7193]);</div><div class="line">        unlink(<span class="stringliteral">&quot;.reg.7193&quot;</span>);</div><div class="line">    }</div><div class="line">    free(files);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> test_sparse_updates(<span class="keywordtype">void</span>)</div><div class="line">{</div><div class="line">    <span class="keyword">struct </span><a class="code" href="structio__uring.html">io_uring</a> ring;</div><div class="line">    <span class="keywordtype">int</span> ret, i, *fds, newfd;</div><div class="line"></div><div class="line">    ret = <a name="a17"></a><a class="code" href="liburing_8h.html#a36db86929382fe81ed115cd093dac627">io_uring_queue_init</a>(8, &amp;ring, 0);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;queue_init: %d\n&quot;</span>, ret);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    fds = malloc(256 * <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++)</div><div class="line">        fds[i] = -1;</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(&amp;ring, fds, 256);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;file_register: %d\n&quot;</span>, ret);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    newfd = 1;</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++) {</div><div class="line">        ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(&amp;ring, i, &amp;newfd, 1);</div><div class="line">        <span class="keywordflow">if</span> (ret != 1) {</div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;file_update: %d\n&quot;</span>, ret);</div><div class="line">            <span class="keywordflow">return</span> ret;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(&amp;ring);</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++)</div><div class="line">        fds[i] = 1;</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#aa4194baf9f0b6dbf5af43dc8aeb9f8ae">io_uring_register_files</a>(&amp;ring, fds, 256);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        fprintf(stderr, <span class="stringliteral">&quot;file_register: %d\n&quot;</span>, ret);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    newfd = -1;</div><div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; 256; i++) {</div><div class="line">        ret = <a class="code" href="liburing_8h.html#a9b75ee695ed52f4422b20e970277908b">io_uring_register_files_update</a>(&amp;ring, i, &amp;newfd, 1);</div><div class="line">        <span class="keywordflow">if</span> (ret != 1) {</div><div class="line">            fprintf(stderr, <span class="stringliteral">&quot;file_update: %d\n&quot;</span>, ret);</div><div class="line">            <span class="keywordflow">return</span> ret;</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <a class="code" href="liburing_8h.html#ae3315029bfded8fb26f26b06bac5af79">io_uring_unregister_files</a>(&amp;ring);</div><div class="line"></div><div class="line">    <a name="a18"></a><a class="code" href="liburing_8h.html#aadf0540bba49f77a7a27593c9151482b">io_uring_queue_exit</a>(&amp;ring);</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> <a name="a19"></a><a class="code" href="io__uring-cp_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">    <span class="keyword">struct </span><a class="code" href="structio__uring.html">io_uring</a> ring;</div><div class="line">    <span class="keywordtype">int</span> ret;</div><div class="line"></div><div class="line">    ret = <a class="code" href="liburing_8h.html#a36db86929382fe81ed115cd093dac627">io_uring_queue_init</a>(8, &amp;ring, 0);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;ring setup failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> 1;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_basic(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_basic failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_basic_many(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_basic_many failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_sparse(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_sparse failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (no_update)</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">    ret = test_additions(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_additions failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_removals(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_removals failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_replace(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_replace failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_replace_all(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_replace_all failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_grow(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_grow failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_shrink(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_shrink failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_zero(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_zero failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_huge(&amp;ring);</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_huge failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    ret = test_sparse_updates();</div><div class="line">    <span class="keywordflow">if</span> (ret) {</div><div class="line">        printf(<span class="stringliteral">&quot;test_sparse_updates failed\n&quot;</span>);</div><div class="line">        <span class="keywordflow">return</span> ret;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
